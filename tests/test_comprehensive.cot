// Comprehensive test exercising all language features
// Returns 42 on success, or error code indicating which feature failed
// Error codes: 1-9 arithmetic, 10-19 control flow, 20-29 data structures,
//              30-39 strings, 40-49 functions, 50-59 types

// ============================================================
// Helper functions
// ============================================================

fn add(a: i64, b: i64) i64 {
    return a + b;
}

fn get_ten() i64 {
    return 10;
}

// Struct definition
struct Point {
    x: int,
    y: int,
}

fn make_point(x: int, y: int) Point {
    return Point{ .x = x, .y = y };
}

// Enum definition
enum Color: i64 {
    red = 1,
    green = 2,
    blue = 3,
}

// Union definition
union Result {
    ok: int,
    err: int,
}

// Type alias
type Int = i64

// ============================================================
// Main test function
// ============================================================

fn main() i64 {
    // --------------------------------------------
    // Test 1: Basic arithmetic
    // --------------------------------------------
    var x = 10;
    var y = 5;
    if x + y != 15 { return 1; }
    if x - y != 5 { return 2; }
    if x * y != 50 { return 3; }
    if x / y != 2 { return 4; }

    // --------------------------------------------
    // Test 2: Compound assignment
    // --------------------------------------------
    var z = 10;
    z += 5;
    if z != 15 { return 5; }
    z -= 3;
    if z != 12 { return 6; }
    z *= 2;
    if z != 24 { return 7; }

    // --------------------------------------------
    // Test 3: Comparisons
    // --------------------------------------------
    if x < y { return 8; }
    if x <= y { return 9; }

    // --------------------------------------------
    // Test 4: Boolean operations
    // --------------------------------------------
    if x == 10 and y == 5 {
        // pass
    } else {
        return 12;
    }
    if x == 10 or y == 10 {
        // pass
    } else {
        return 14;
    }

    // --------------------------------------------
    // Test 5: If statements
    // --------------------------------------------
    if x == 10 {
        // pass
    } else {
        return 16;
    }

    if x == 5 {
        return 17;
    }

    // Nested if
    if x > 5 {
        if y < 10 {
            // pass
        } else {
            return 18;
        }
    } else {
        return 19;
    }

    // --------------------------------------------
    // Test 6: While loop
    // --------------------------------------------
    var counter = 0;
    while counter < 5 {
        counter += 1;
    }
    if counter != 5 { return 20; }

    // --------------------------------------------
    // Test 7: Arrays
    // --------------------------------------------
    var arr = [10, 20, 30, 40, 50];
    if arr[0] != 10 { return 21; }
    if arr[4] != 50 { return 22; }
    if len(arr) != 5 { return 23; }

    // Dynamic indexing
    var idx = 2;
    if arr[idx] != 30 { return 24; }

    // --------------------------------------------
    // Test 8: For loop over array
    // --------------------------------------------
    var sum: i64 = 0;
    for item in arr {
        sum = sum + item;
    }
    if sum != 150 { return 25; }

    // --------------------------------------------
    // Test 9: Slices
    // --------------------------------------------
    var slice = arr[1:4];
    if len(slice) != 3 { return 26; }
    if slice[0] != 20 { return 27; }
    if slice[2] != 40 { return 28; }

    // --------------------------------------------
    // Test 10: Strings
    // --------------------------------------------
    var s = "hello";
    if len(s) != 5 { return 30; }
    if s[0] != 104 { return 31; }  // 'h'

    // String comparison
    if s != "hello" { return 32; }
    if s == "world" { return 33; }

    // String slicing
    var sub = s[0:3];
    if len(sub) != 3 { return 34; }

    // --------------------------------------------
    // Test 11: Structs
    // --------------------------------------------
    var p = Point{ .x = 3, .y = 4 };
    if p.x != 3 { return 35; }
    if p.y != 4 { return 36; }

    // Struct from function
    var p2 = make_point(5, 6);
    if p2.x != 5 { return 37; }

    // --------------------------------------------
    // Test 12: Enums
    // --------------------------------------------
    var c = Color.green;
    var color_val = @intFromEnum(c);
    if color_val != 2 { return 39; }

    // --------------------------------------------
    // Test 13: Unions
    // --------------------------------------------
    var result = Result.ok(42);
    var val = switch result {
        .ok |v| => v,
        .err |e| => e,
    };
    if val != 42 { return 40; }

    // --------------------------------------------
    // Test 14: Function calls
    // --------------------------------------------
    if add(3, 4) != 7 { return 41; }
    if get_ten() != 10 { return 43; }

    // Multiple function calls in expression
    var multi = get_ten() + get_ten() + get_ten();
    if multi != 30 { return 44; }

    // --------------------------------------------
    // Test 15: Switch on integers
    // --------------------------------------------
    var sw = 2;
    var sw_result = switch sw {
        1 => 10,
        2 => 42,
        3 => 30,
        else => 0,
    };
    if sw_result != 42 { return 45; }

    // --------------------------------------------
    // Test 16: Type alias
    // --------------------------------------------
    const aliased: Int = 99;
    if aliased != 99 { return 48; }

    // --------------------------------------------
    // Test 17: Maps
    // --------------------------------------------
    var m = new Map<string, i64>()
    m.set("key", 100)
    if m.get("key") != 100 { return 50; }

    // --------------------------------------------
    // Test 18: Lists
    // --------------------------------------------
    var list = new List<i64>()
    list.push(1)
    list.push(2)
    list.push(3)
    if list.get(0) != 1 { return 51; }
    if list.get(2) != 3 { return 52; }

    // --------------------------------------------
    // All tests passed
    // --------------------------------------------
    return 42;
}
